---
title: "Aboveground-Seascape Carbon"
output: html_notebook
---

Aboveground Cover
```{r}
#Libraries
library(ggplot2)
library(dplyr)
library(tidyverse)
library(plotrix)
```

```{r}
#set working directory
setwd("~/OneDrive - Old Dominion University/Ongoing Research/SG-Carbon.Ecotone/R.Data")
#Define Dataset
Aboveground<-(read.csv("AbCover.Clean.csv"))
```

Multiplot Function
```{r}
#Multiplot
multiplot <- function(..., plotlist = NULL, file, cols = 1, layout = NULL) {
  require(grid)
  plots <- c(list(...), plotlist)
  numPlots = length(plots)
  if (is.null(layout)) {
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))}
  if (numPlots == 1) {
    print(plots[[1]])} else {
      grid.newpage()
      pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
      for (i in 1:numPlots) {
        matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
        print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                        layout.pos.col = matchidx$col))}}}
```
#Subset Data
```{r}
#Seagrass
#Subset Data for just seagrass
SG.Cov<- subset(Aboveground, Aboveground$Type == "SG")
#Remove Labrador Park ("LP-1")
SG.Cov<-subset(SG.Cov, SG.Cov$Transect != "LP.1")

#export to JMP

write.csv(SG.Cov,"~/OneDrive - Old Dominion University/Ongoing Research/SG-Carbon.Ecotone/R.Data/SG.COV.csv", row.names = FALSE)

#Mangrove- SB
#Subset Data for just Mangrove
MF.SB.Cov<- subset(Aboveground, Aboveground$Type == "MF")
#Remove All PU sites
MF.SB.Cov<-subset(MF.SB.Cov,Transect != "PU.1")
MF.SB.Cov<-subset(MF.SB.Cov,Transect != "PU.2")
MF.SB.Cov<-subset(MF.SB.Cov,Transect != "PU.3") 

#export to JMP
write.csv(MF.SB.Cov,"~/OneDrive - Old Dominion University/Ongoing Research/SG-Carbon.Ecotone/R.Data/MF.SB.Cov.csv", row.names = FALSE)

#Mangrove-PU
#Subset Data for just Mangrove
MF.PU.Cov<- subset(Aboveground, Aboveground$Type == "MF")
#Remove All SB sites
MF.PU.Cov<-subset(MF.PU.Cov,Transect != "SB.1")
MF.PU.Cov<-subset(MF.PU.Cov,Transect != "SB.2")
MF.PU.Cov<-subset(MF.PU.Cov,Transect != "SB.3")

#export to SIGMAPlot
write.csv(MF.PU.Cov,"~/OneDrive - Old Dominion University/Ongoing Research/SG-Carbon.Ecotone/R.Data/MF.PU.Cov.csv", row.names = FALSE)

#confidence intervals from sigmaplot
#Dataset with predictions and confidence intervals
library(readxl)
CI.Values.Cov<-read_excel("~/OneDrive - Old Dominion University/Ongoing Research/SG-Carbon.Ecotone/R.Data/Confidence Interval Values - Cover.xlsx", sheet = NULL)


```


#Seagrass With End Points (All)
```{r}

#Values from Sigmaplot- Regression Wizard
#Sigmoidal 4P

#Generic Function
#f= y0+ a/(1+exp(-(x-x0)/b))
#a=65.0469
#b=-0.1228
#x0=-0.0418
#y0=0.4583

#r2= 0.8331

fun2.AG.SG.Sig <- function(x) {
  (0.4583+65.0469/(1+exp(-(x-(-0.0418))/-0.1228)))
  }

#plot curve to see what it looks like
curve(fun2.AG.SG.Sig, -38,26, ylab = "cover")
#Returns first derivative
D(expression((0.4583+65.0469/(1+exp(-(x-(-0.0418))/-0.1228)))), 'x')

#Function of first derivative
AG.SG.D1 <-function(x){-(65.0469 * (exp(-(x - (-0.0418))/-0.1228) * (1/0.1228))/(1 + 
    exp(-(x - (-0.0418))/-0.1228))^2)}

#Plots first derivative
curve(AG.SG.D1, -38,26) 
#produces 1st derivative minimum (in this case)/aka inflection point of original equation
optimize(AG.SG.D1, interval = c(-38,26)) 
#$minimum
#[1]-0.04180072 <- This is the inflection point for Seagrass Cover

#Y value for inflection point using minimum
AG.SG.D1_Y <-  (0.4583+65.0469/(1+exp(-(-0.418-(-0.0418))/-0.1228)))
print(AG.SG.D1_Y) #
#62.60167 <-----Y Value of Inflection Point

#Calculation of 2nd Derivative
D(expression((-(65.0469 * (exp(-(x - (-0.0418))/-0.1228) * (1/0.1228))/(1 + 
    exp(-(x - (-0.0418))/-0.1228))^2))), 'x')
  
#2nd Derivative
AG.SG.D2 <- function(x) {-(65.0469 * (exp(-(x - (-0.0418))/-0.1228) * (1/0.1228) * (1/0.1228))/(1 + 
    exp(-(x - (-0.0418))/-0.1228))^2 - 65.0469 * (exp(-(x - (-0.0418))/-0.1228) * 
    (1/0.1228)) * (2 * (exp(-(x - (-0.0418))/-0.1228) * (1/0.1228) * 
    (1 + exp(-(x - (-0.0418))/-0.1228))))/((1 + exp(-(x - (-0.0418))/-0.1228))^2)^2)
}
#Plot of 2nd Derivative
curve(AG.SG.D2, -38,26)

optimize(AG.SG.D2, interval = c(-38,26), maximum = TRUE) # Max of 2nd derivative
optimize(AG.SG.D2, interval = c(-38,26)) # Minimum of 2nd derivative

#SG Cover AoT
#-0.2035561 to 0.119921
```

#Seagrass With End Points (Total)
```{r}
SeagrassAbvgd<- ggplot() +
  xlab("Plot (m)") + #x-label
  ylab("Seagrass Cover (%)")+ #y-label
  ylim(-20,100) + #y-axis values
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"),
        legend.position = "none") +#Removes gray gridlines 
  geom_ribbon(data = CI.Values.Cov, aes(x = CJ.Cov.Plot, ymin = CJ.Cov.CI.Low, ymax= CJ.Cov.CI.High), color = "black", linetype= "dotted", fill = "gray", alpha = 0.7)+
  geom_rect(data=SG.Cov, mapping=aes(xmin=-0.2035561, xmax=0.119921, ymin=-1, ymax=105),fill = "blue", alpha=0.01)+ # box
  geom_jitter(data = SG.Cov, aes(x=Plot, y=SeagrassCov), color = "blue", size = 1)+ #points w/ jitter
  stat_function(xlim =c(-39,26), fun = fun2.AG.SG.Sig, colour = "black")+#function curve for SG.AG.Cover
  geom_vline(xintercept=-0.04180072, linetype='dashed', color='black', size=1)+
  scale_x_continuous(limits=c(-40,27), breaks=c(-40,-30, -20, -10, 0, 10, 20, 30))+# x-axis breaks
  scale_y_continuous(limits=c(-200,300), breaks=c(0,25, 50, 75, 100))+ # y axis breaks and limits
coord_cartesian(ylim = c(-20, 110))
print(SeagrassAbvgd)

```

#Sigmoidal Regression Equation- MF.SB Cover
```{r}
#Values from Sigmaplot- Dynamic Fit
#Sigmoidal 4P

#Generic Function
#f= y0+ a/(1+exp(-(x-x0)/b))
#a=86.3814
#b=-1.0878
#x0=0.8486
#y0=9.4167

#r2= 0.9327

fun2.AG.MF.SB.Sig <- function(x) {
  (9.4167+86.3814/(1+exp(-(x-(0.8486))/-1.0878)))
  }


#plot curve to see what it looks like
curve(fun2.AG.MF.SB.Sig, -22,22, ylab = "cover")
#Returns first derivative
D(expression(9.4167+86.3814/(1+exp(-(x-(0.8486))/-1.0878))), 'x')

#Function of first derivative
AG.MF.SB.D1 <-function(x){-(86.3814 * (exp(-(x - (0.8486))/-1.0878) * (1/1.0878))/(1 + 
    exp(-(x - (0.8486))/-1.0878))^2)}

#Plots first derivative
curve(AG.MF.SB.D1,  -22,22) 
#produces 1st derivative minimum (in this case)/aka inflection point of original equation
optimize(AG.MF.SB.D1, interval = c( -22,22)) 
#minimum
# 0.8485979 <- This is the inflection point for Mangrove-SB Cover

#Y value for inflection point using minimum
AG.MF.SB.D1_Y <- ((9.4167+86.3814/(1+exp(-(0.8486-(0.8486))/-1.0878))))
print(AG.MF.SB.D1_Y) #
#52.6074 <-----Y Value of Inflection Point

#Calculation of 2nd Derivative
D(expression(-(86.3814 * (exp(-(x - (0.8486))/-1.0878) * (1/1.0878))/(1 + 
    exp(-(x - (0.8486))/-1.0878))^2)), 'x')
  

#2nd Derivative
AG.MF.SB.D2 <- function(x) {-(86.3814 * (exp(-(x - (0.8486))/-1.0878) * (1/1.0878) * (1/1.0878))/(1 + 
    exp(-(x - (0.8486))/-1.0878))^2 - 86.3814 * (exp(-(x - (0.8486))/-1.0878) * 
    (1/1.0878)) * (2 * (exp(-(x - (0.8486))/-1.0878) * (1/1.0878) * 
    (1 + exp(-(x - (0.8486))/-1.0878))))/((1 + exp(-(x - (0.8486))/-1.0878))^2)^2)
}
#Plot of 2nd Derivative
curve(AG.MF.SB.D2, -22,22)

optimize(AG.MF.SB.D2, interval = c(-22,22), maximum = TRUE) # Max of 2nd derivative
optimize(AG.MF.SB.D2, interval = c(-22,22)) # Minimum of 2nd derivative

#Mangrove.SB Cover AoT
# -0.5839978 to 2.281202

```

#Plot Data- AG. MF-SB
```{r}
Mangrove.SB.AG<- ggplot() +
  xlab("Plot (m)") + #x-label
  ylab("Mangrove Cover (%)")+ #y-label
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"))+
        #legend.position = "none") +#Removes gray gridlines 
  geom_ribbon(data = CI.Values.Cov, aes(x = SB.Cov.Plot, ymin = SB.Cov.CI.Low, ymax= SB.CI.High), color = "black", linetype= "dotted", fill = "gray", alpha = 0.7)+
  geom_rect(data=MF.SB.Cov, mapping=aes(xmin=-0.5839978, xmax=2.281202, ymin=-Inf, ymax=Inf), fill = "green3", alpha=0.01)+ # box
  geom_jitter(data = MF.SB.Cov, aes(x=Plot, y=MangCanCov), color = "darkgreen", size = 1)+ #points
    stat_function(xlim =c(-22,22), fun = fun2.AG.MF.SB.Sig, colour = "black") +#function curve for MF.SB.AG.Cover
geom_vline(xintercept=0.8485979, linetype='dashed', color='black', size=1)+
  scale_x_continuous(limits=c(-25,25), breaks=c(-20, -10, 0, 10, 20))+# x-axis breaks
  scale_y_continuous(limits=c(-20,110), breaks=c(0,25, 50, 75, 100))+ # y axis breaks and limits
  coord_cartesian(ylim = c(-20, 110))

print(Mangrove.SB.AG)
```
#Sigmoidal Regression Equation- MF.PU Cover
```{r}
#Values from Sigmaplot- Regression Wizard
#Sigmoidal 4P

#Generic Function
#f= y0+ a/(1+exp(-(x-x0)/b))
#a=94.4186
#b=-0.7772
#x0=0.6202
#y0=0.2244

#r2= 0.9639

fun2.AG.MF.PU.Sig <- function(x) {
  (0.2244+94.4186/(1+exp(-(x-(0.6202))/-0.7772)))
  }

#plot curve to see what it looks like
curve(fun2.AG.MF.PU.Sig, -32,22, ylab = "cover")
#Returns first derivative
D(expression((0.2244+94.4186/(1+exp(-(x-(0.6202))/-0.7772)))), 'x')

#Function of first derivative
AG.MF.PU.D1 <-function(x){-(94.4186 * (exp(-(x - (0.6202))/-0.7772) * (1/0.7772))/(1 + 
    exp(-(x - (0.6202))/-0.7772))^2)}

#Plots first derivative
curve(AG.MF.PU.D1, -32,22) 
#produces 1st derivative minimum (in this case)/aka inflection point of original equation
optimize(AG.MF.PU.D1, interval = c(-8,8)) 
#minimum
# 0.6202 <- This is the inflection point for Mangrove-PU Cover

#Y value for inflection point using minimum
AG.MF.PU.D1_Y <- (0.2244+94.4186/(1+exp(-(0.6202-(0.6202))/-0.7772)))
print(AG.MF.PU.D1_Y) #
#47.4337 <-----Y Value of Inflection Point

#Calculation of 2nd Derivative
D(expression(-(94.4186 * (exp(-(x - (0.6202))/-0.7772) * (1/0.7772))/(1 + 
    exp(-(x - (0.6202))/-0.7772))^2)), 'x')
  

#2nd Derivative
AG.MF.PU.D2 <- function(x) {-(94.4186 * (exp(-(x - (0.6202))/-0.7772) * (1/0.7772) * (1/0.7772))/(1 + 
    exp(-(x - (0.6202))/-0.7772))^2 - 94.4186 * (exp(-(x - (0.6202))/-0.7772) * 
    (1/0.7772)) * (2 * (exp(-(x - (0.6202))/-0.7772) * (1/0.7772) * 
    (1 + exp(-(x - (0.6202))/-0.7772))))/((1 + exp(-(x - (0.6202))/-0.7772))^2)^2)
}
#Plot of 2nd Derivative
curve(AG.MF.PU.D2, -35,22)

optimize(AG.MF.PU.D2, interval = c(-8,8), maximum = TRUE) # Max of 2nd derivative
optimize(AG.MF.PU.D2, interval = c(-8,8)) # Minimum of 2nd derivative

#Mangrove.PU Cover AoT
# -0.4033395 to 1.643729

```


#Plot Data- MF-PU
```{r}
Mangrove.PU.AG<- ggplot(MF.PU.Cov) +
  xlab("Plot (m)") + #x-label
  ylab("Mangrove Cover (%)")+ #y-label
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        axis.line = element_line(colour = "black"), legend.position = "none") +#Removes gray gridlines 
  geom_ribbon(data = CI.Values.Cov, aes(x = PU.Cov.Plot, ymin = PU.Cov.CI.Low, ymax= PU.Cov.CI.High), color = "black", linetype= "dotted", fill = "gray", alpha = 0.7)+
  geom_rect(data=MF.PU.Cov, mapping=aes(xmin=-0.4033395, xmax=1.643729, ymin=-1, ymax=105), fill = "green3", alpha=0.01)+ # box
  geom_jitter(data = MF.PU.Cov, aes(x=Plot, y=MangCanCov), color = "darkgreen", size = 1)+
   stat_function(xlim =c(-32,22), fun = fun2.AG.MF.PU.Sig, colour = "black")+ #function curve for MF..Mang.Cover
geom_vline(xintercept=0.6202, linetype='dashed', color='black', size=1)+
  scale_x_continuous(limits=c(-35,25), breaks=c(-30, -20, -10, 0, 10, 20, 30))+ # x-axis breaks
  scale_y_continuous(limits=c(-20,110), breaks=c(0,25, 50, 75, 100))+ # y axis breaks and limits
  coord_cartesian(ylim = c(-20, 110))

print(Mangrove.PU.AG)
```


Multiplot
```{r}
Abvgdall<-multiplot(SeagrassAbvgd, Mangrove.SB.AG, Mangrove.PU.AG, cols = 3)
```
print(Abvgdall)


Multiplot
```{r}
#Abvgdmmm<-multiplot(Mangrove.SB.AG, Mangrove.PU.AG, cols = 2)
```
print(Abvgdmmm)

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

